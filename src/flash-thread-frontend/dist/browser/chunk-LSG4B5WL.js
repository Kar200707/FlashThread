import{a as se}from"./chunk-FWMO6DTU.js";import{a as H}from"./chunk-VNKSPXN3.js";import{a as ne,b as ie}from"./chunk-7SP2NWYR.js";import{a as R,c as _}from"./chunk-37RFCEB7.js";import{$ as m,Ab as Z,Bb as ee,Cb as te,E as S,I as h,Ia as F,J as f,Ja as q,Pa as D,R as b,Sa as N,U as r,V as M,aa as T,ba as j,ca as v,da as x,ea as C,fa as c,ga as l,ha as O,ka as w,ma as u,na as g,ob as $,pb as G,qa as y,qb as A,ra as p,rb as Q,sa as P,ta as I,tb as W,ua as E,ub as L,va as U,vb as Y,xa as V,xb as J,ya as z,yb as K,za as B,zb as X}from"./chunk-PWFBOZXI.js";var oe=["messagesScrollBox"];function re(o,d){if(o&1&&(c(0,"p"),p(1),l()),o&2){let n=g();r(1),I("Last seen ",(n.userInfo.last_connection==null?null:n.userInfo.last_connection.hours)+":"+(n.userInfo.last_connection==null?null:n.userInfo.last_connection.minutes),"")}}function ae(o,d){o&1&&(c(0,"p"),p(1," Online "),l())}function ce(o,d){if(o&1){let n=w();c(0,"div",20)(1,"mat-icon",21),u("click",function(){h(n);let s=g().$implicit,t=g(2);return f(t.deleteMessage(s.id))}),p(2,"delete"),l()()}}function le(o,d){if(o&1&&O(0,"img",22),o&2){let n=g(3);m("src",n.userInfo.avatar,b)}}function de(o,d){if(o&1){let n=w();c(0,"div",15),u("mousedown",function(){let t=h(n).$implicit,i=y(2),a=g(2);return f(a.thisUser.id===t.userId?a.selectMessage(i):!1)})("mouseup",function(){let t=h(n).$implicit,i=y(2),a=g(2);return f(a.thisUser.id===t.userId?a.unselectMessage(i):!1)})("click",function(){let t=h(n).$implicit,i=g(2);return f(i.thisUser.id!==t.userId?i.isOpenedMessageOptions=!1:!1)}),c(1,"div",16,17),u("click",function(){let t=h(n).$implicit,i=g(2);return f(i.emoji(i.thisUser.id!==t.userId,t.emoji,t.id))}),x(3,ce,3,0,"div",18)(4,le,1,1,"img",19),p(5),l()()}if(o&2){let n=d.$implicit,e=g(2);v(e.thisUser.id!==n.userId?"message_box_reverce":"message_box"),T("border-top",e.thisUser.id===n.userId&&e.isOpenedMessageOptions?"1px solid rgba(255,255,255,0.4)":"0")("border-bottom",e.thisUser.id===n.userId&&e.isOpenedMessageOptions?"1px solid rgba(255,255,255,0.4)":"0")("padding",e.thisUser.id===n.userId&&e.isOpenedMessageOptions?"3px 0":"0")("background-color",e.thisUser.id===n.userId&&e.isOpenedMessageOptions?"rgba(255,255,255,0.12)":"transparent"),r(1),v(e.thisUser.id!==n.userId&&n.emoji?"message emoji":"message"),j("emoji_reverse",e.thisUser.id===n.userId&&n.emoji),r(2),C(3,e.thisUser.id===n.userId&&e.isOpenedMessageOptions?3:-1),r(1),C(4,e.chatMessaging.usersId.length===2&&e.thisUser.id!==n.userId?4:-1),r(1),I(" ",n.message," ")}}function ge(o,d){if(o&1&&(c(0,"div",23)(1,"div",24),O(2,"img",22)(3,"div",25)(4,"div",25)(5,"div",25),l()()),o&2){let n=g(2);r(2),m("src",n.userInfo.avatar,b)}}function pe(o,d){if(o&1&&(c(0,"div")(1,"div",11),O(2,"img",12),c(3,"h4"),p(4),l(),c(5,"p"),p(6),l()(),x(7,de,6,17,"div",13)(8,ge,6,1,"div",14),l()),o&2){let n=g();r(2),m("src",n.userInfo.avatar,b),r(2),P(n.userInfo.name),r(2),P(n.userInfo.bio),r(1),m("ngForOf",n.chatMessaging.messages),r(1),C(8,n.isPrint?8:-1)}}var ye=(()=>{let d=class d{constructor(e,s,t){this.activatedRoute=e,this.reqService=s,this.webSocket=t,this.isPrint=!1,this.isOpenedMessageOptions=!1,this.touchTime=0,this.isChackChatValid=!0,this.token=localStorage.getItem("token"),this.form=new Y({message:new J("",Q.required)}),this.innerWidth=innerWidth,this.setTimeout=setTimeout,this.webSocket.listen("message").subscribe(i=>{if(this.chatMessaging.messages.push(i),setTimeout(()=>{this.messagesBoxScroll&&(this.messagesBoxScroll.nativeElement.scrollTop=this.messagesBoxScroll.nativeElement.scrollHeight)},100),this.thisUser.id!=i.userId){let a=new Audio;a.src="./assets/audios/notifiaction/tones.mp3",a.load(),a.play()}})}scrollDown(){setTimeout(()=>{this.messagesBoxScroll&&(this.messagesBoxScroll.nativeElement.scrollTop=this.messagesBoxScroll.nativeElement.scrollHeight)},100)}ngOnInit(){this.activatedRoute.params.subscribe(e=>{this.idParam=e.id;let s=e.id,t={token:this.token,id:s};this.reqService.post(_.getUserById,t).subscribe(a=>{this.userInfo=a});let i={token:this.token};this.reqService.post(_.getUserByToken,i).subscribe(a=>{this.webSocket.emit("join",{id:a.id}),this.thisUser=a,this.reqService.post(_.checkChat,{id1:s,id2:a.id}).subscribe(k=>{this.chatMessaging=k,this.chatInfo=k,setTimeout(()=>{this.messagesBoxScroll&&(this.messagesBoxScroll.nativeElement.scrollTop=this.messagesBoxScroll.nativeElement.scrollHeight)},100),this.isChackChatValid=k.status!==400})})})}send(){if(this.form.value.message){if(!this.isChackChatValid){let i={id:0,usersId:[],messages:[]};this.chatMessaging=i,this.addNewChat().subscribe(a=>{this.chatMessaging=a,this.chatInfo=a,this.isChackChatValid=!0})}let e=new Date,s={message:this.form.value.message,userId:this.thisUser.id?this.thisUser.id:"",date:{day:e.getDay(),month:e.getMonth(),year:e.getFullYear(),hours:e.getHours(),minutes:e.getMinutes(),date:e.getDate()}};this.chatMessaging.messages.push(s);let t={message:this.form.value.message,chatId:this.chatInfo.id,token:this.token};this.webSocket.emit("message",t)}this.form.reset(),setTimeout(()=>{this.messagesBoxScroll?.nativeElement.scrollTo(0,this.messagesBoxScroll?.nativeElement.scrollHeight)},100)}printing(){}addNewChat(){let e=this.idParam;return this.reqService.post(_.chat,{clientToken:this.token,message:this.form.value.message,userId:e})}deleteMessage(e){confirm("delete this message?")&&this.reqService.delete(_.chatMessagesDelete,{token:this.token,chatId:this.chatMessaging.id,messageId:e}).subscribe(s=>{this.isOpenedMessageOptions=!1,this.chatMessaging.messages=s})}selectMessage(e){e.style.transition=".3s",e.style.scale=".96",this.messageSelectTimeOut=setTimeout(()=>{this.isOpenedMessageOptions=!0},800)}unselectMessage(e){e.style.transition=".3s",e.style.scale="1",clearTimeout(this.messageSelectTimeOut)}emoji(e,s,t){this.touchTime==0?this.touchTime=new Date().getTime():new Date().getTime()-this.touchTime<800?e&&(s?this.reqService.post(_.removeEmoji,{token:this.token,chatId:this.chatMessaging.id,messageId:t}).subscribe(i=>{this.isOpenedMessageOptions=!1,this.chatMessaging.messages=i}):this.reqService.post(_.setEmoji,{token:this.token,chatId:this.chatMessaging.id,messageId:t}).subscribe(i=>{this.isOpenedMessageOptions=!1,this.chatMessaging.messages=i})):this.touchTime=new Date().getTime()}};d.\u0275fac=function(s){return new(s||d)(M(D),M(R),M(se))},d.\u0275cmp=S({type:d,selectors:[["app-chat"]],viewQuery:function(s,t){if(s&1&&z(oe,5),s&2){let i;V(i=B())&&(t.messagesBoxScroll=i.first)}},standalone:!0,features:[E([]),U],decls:20,vars:8,consts:[[1,"main-div"],[1,"lear"],[1,"selected_chat_user"],["routerLink","/chats-menu"],["appResizeHeight","",1,"messages_scroll_box",3,"size"],["messagesScrollBox",""],[4,"ngIf"],[1,"message_sending_panel"],[3,"formGroup","ngSubmit"],["matInput","","formControlName","message","placeholder","Type your message...","name","message","type","text",1,"message_input",3,"focus","input"],[1,"send_button",3,"disabled","click"],[1,"user_box"],["alt","avatar",3,"src"],[3,"border-top","border-bottom","padding","background-color","class","mousedown","mouseup","click",4,"ngFor","ngForOf"],["class","message_box_reverce"],[3,"mousedown","mouseup","click"],[3,"click"],["myMessage",""],["class","message_options"],["class","in-chat-user-avatar","alt","user img",3,"src"],[1,"message_options"],["color","warn",3,"click"],["alt","user img",1,"in-chat-user-avatar",3,"src"],[1,"message_box_reverce"],[1,"message"],[1,"circle"]],template:function(s,t){s&1&&(c(0,"div",0)(1,"div",1)(2,"div",2)(3,"a",3)(4,"mat-icon"),p(5,"arrow_back_ios"),l()(),c(6,"div")(7,"h2"),p(8),l(),x(9,re,2,1,"p")(10,ae,2,0),l()(),c(11,"div",4,5),x(13,pe,9,5,"div",6),l(),c(14,"div",7)(15,"form",8),u("ngSubmit",function(){return t.send()}),c(16,"input",9),u("focus",function(){return t.scrollDown()})("input",function(){return t.printing()}),l(),c(17,"button",10),u("click",function(){return t.send()}),c(18,"mat-icon"),p(19,"arrow_upward"),l()()()()()()),s&2&&(r(8),P(t.userInfo?t.userInfo.name:"..."),r(1),C(9,t.userInfo&&!t.userInfo.isOnline?9:10),r(2),m("size",t.innerWidth>940?130:140),r(2),m("ngIf",t.chatMessaging&&t.userInfo),r(2),m("formGroup",t.form),r(2),m("disabled",t.form.invalid),r(1),v(t.form.valid?"send_button_icon-anim":""))},dependencies:[H,G,$,te,K,A,W,L,X,Z,F,ie,ne,ee,q,N],styles:['.main-div[_ngcontent-%COMP%]{background-color:#262626;height:100vh}.lear[_ngcontent-%COMP%]{height:100%;display:flex;align-items:center;flex-direction:column;padding:58px 20px 0;position:relative;backdrop-filter:blur(2px);-webkit-backdrop-filter:blur(2px);background-color:#0000001f}[_ngcontent-%COMP%]::-webkit-scrollbar{width:0}.message[_ngcontent-%COMP%]{padding:10px 20px;border-radius:20px 20px 0;background:rgb(0,80,239);display:flex;align-items:center;position:relative;margin-left:40px;color:#fff;font-family:Poppins;font-weight:400;line-height:21px;text-align:left}.message_box[_ngcontent-%COMP%]{width:100%;display:flex;align-items:center;justify-content:end;margin-top:20px}.message_box_reverce[_ngcontent-%COMP%]{width:100%;display:flex;align-items:center;justify-content:start;margin-top:20px}.message_box_reverce[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{padding:10px 20px;background-image:none;background-color:#0e0e0e;border:1px solid #ffffff26;border-radius:20px 20px 20px 0;color:#fff}.message_sending_panel[_ngcontent-%COMP%]{position:fixed;bottom:0;background-color:#000;padding:16px 30px;width:100%;border-top-left-radius:32px;border-top-right-radius:32px}.circle[_ngcontent-%COMP%]{background-color:#fff;width:10px;height:10px;border-radius:50%;margin:0}.circle[_ngcontent-%COMP%] + .circle[_ngcontent-%COMP%]{opacity:.4;margin:0 5px}.circle[_ngcontent-%COMP%] + .circle[_ngcontent-%COMP%] + .circle[_ngcontent-%COMP%]{opacity:.2;margin:0}.message_sending_panel[_ngcontent-%COMP%] > form[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center}.message_input[_ngcontent-%COMP%]{background-color:#262626;display:block;border:none;outline:none;width:85%;border-radius:30px;padding:11px 24px;color:#fff;font-family:Poppins;font-size:16px;font-weight:400;line-height:18px;text-align:left;margin-right:20px}.message_input[_ngcontent-%COMP%]::placeholder{color:#7a7a7a}.controllers_box[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:flex-end;padding:0 25px}.send_button[_ngcontent-%COMP%]{width:40px;height:40px;border:none;border-radius:50%;background-color:#fff}.send_button[_ngcontent-%COMP%]:disabled{opacity:.3}.send_button[_ngcontent-%COMP%] > mat-icon[_ngcontent-%COMP%]{color:#7100ff}.send_button_icon-anim[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_send_anim alternate-reverse .4s ease-in-out infinite}@keyframes _ngcontent-%COMP%_send_anim{0%{margin-bottom:10px}to{margin-bottom:-10px;scale:1}}.messages_scroll_box[_ngcontent-%COMP%]{width:100%;overflow-y:scroll;padding-bottom:40px}.selected_chat_user[_ngcontent-%COMP%]{justify-content:center;z-index:500;padding:10px 25px;background-color:#000;position:absolute;left:0;top:0;width:100%;display:flex;align-items:center;border-bottom-left-radius:32px;border-bottom-right-radius:32px}.selected_chat_user[_ngcontent-%COMP%] > a[_ngcontent-%COMP%]{position:absolute;left:25px;margin-right:20px;display:none;width:25px}.selected_chat_user[_ngcontent-%COMP%] > a[_ngcontent-%COMP%] > mat-icon[_ngcontent-%COMP%]{color:#fff;display:block;font-size:25px}.selected_chat_user[_ngcontent-%COMP%] > .img_box[_ngcontent-%COMP%]{width:45px;height:45px;position:relative}.selected_chat_user[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] + div[_ngcontent-%COMP%]{margin-left:20px;display:flex;flex-direction:column}.selected_chat_user[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] > p[_ngcontent-%COMP%]{color:#8d8d8d;font-family:Poppins;font-size:12px;font-weight:500;line-height:18px;text-align:center}.selected_chat_user[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] > h2[_ngcontent-%COMP%]{color:#fff;font-family:Poppins;font-size:25px;font-weight:600;line-height:33px;text-align:center}.in-chat-user-avatar[_ngcontent-%COMP%]{width:30px;height:30px;object-fit:cover;border-radius:50%;display:block;position:absolute;left:-40px}.first_message_block[_ngcontent-%COMP%]{background:linear-gradient(to left,rgba(152,46,131,.18),rgba(0,51,153,.2));backdrop-filter:blur(3px);-webkit-backdrop-filter:blur(3px);width:100%;height:100vh;position:absolute;top:84px;z-index:99;display:flex;align-items:center;justify-content:center;flex-direction:column}.first_message_block[_ngcontent-%COMP%] > h3[_ngcontent-%COMP%]{font-size:35px;color:#fff;margin-bottom:30px}.first_message_block[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] > form[_ngcontent-%COMP%] > input[_ngcontent-%COMP%]{font-size:40px;padding:10px 25px;border:none;border-radius:40px;outline:5px solid #363636;background-color:#3d3d3d;font-family:Asap Condensed,sans-serif;letter-spacing:2px;width:500px;color:#fff}.first_message_block[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{position:relative}.first_message_block[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] > form[_ngcontent-%COMP%] > input[_ngcontent-%COMP%]:focus{outline:5px solid #5c13a4}.first_message_block[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] > button[_ngcontent-%COMP%] > mat-icon[_ngcontent-%COMP%]{font-size:35px;width:33px;height:31px;color:#fff;display:flex;align-items:center;justify-content:center}.first_message_block[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] > button[_ngcontent-%COMP%]{border:none;background-color:#639;padding:15px;border-radius:50%;display:flex;align-items:center;justify-content:center;position:absolute;right:3px;top:3px}@media screen and (max-width: 940px){.lear[_ngcontent-%COMP%]{padding:70px 16px 0}.selected_chat_user[_ngcontent-%COMP%]{padding:16px 25px}.selected_chat_user[_ngcontent-%COMP%] > a[_ngcontent-%COMP%]{display:block}}@media screen and (max-width: 594px){.first_message_block[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] > form[_ngcontent-%COMP%] > input[_ngcontent-%COMP%]{width:100%}.first_message_block[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{width:90%}.messages_scroll_box[_ngcontent-%COMP%]{width:100%}.message_box[_ngcontent-%COMP%]{margin-top:5px}.message[_ngcontent-%COMP%]{scale:.9}}@media screen and (max-width: 574px){.first_message_block[_ngcontent-%COMP%] > h3[_ngcontent-%COMP%]{font-size:30px;text-align:center;max-width:90%}}.user_box[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;flex-direction:column;padding:40px 0}.user_box[_ngcontent-%COMP%] > img[_ngcontent-%COMP%]{width:100px;height:100px;border-radius:50%}.user_box[_ngcontent-%COMP%] > h4[_ngcontent-%COMP%]{color:#fff;font-family:Poppins;font-weight:700;margin-top:10px;font-size:25px}.user_box[_ngcontent-%COMP%] > p[_ngcontent-%COMP%]{color:gray;font-family:Poppins;font-weight:700;margin-top:10px}.message_options[_ngcontent-%COMP%]{position:absolute;left:-25px}.emoji[_ngcontent-%COMP%]:after{content:"\\2764\\fe0f";position:absolute;bottom:-10px;right:-10px;background-color:#282828;padding:1px 3px;display:flex;align-items:center;justify-content:center;box-shadow:#00000059 0 5px 15px;border-radius:10px}.emoji_reverse[_ngcontent-%COMP%]:after{content:"\\2764\\fe0f";position:absolute;bottom:-10px;left:-10px;background-color:#282828;padding:1px 3px;display:flex;align-items:center;justify-content:center;box-shadow:#00000059 0 5px 15px;border-radius:10px}']});let o=d;return o})();export{ye as a};
