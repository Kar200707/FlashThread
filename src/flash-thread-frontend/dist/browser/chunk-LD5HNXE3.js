import{a as oe}from"./chunk-XNVZ6SF4.js";import{a as H}from"./chunk-I77EQ6VG.js";import{a as ne,b as ie}from"./chunk-BDNLMVIY.js";import{a as R,c as f}from"./chunk-SV7SBBIN.js";import{K as $,L as A,M as G,N as Q,P as W,Q as L,R as Y,T as J,U as K,V as X,W as Z,X as ee,Y as te,c as D,d as F,j as q,m as N}from"./chunk-EKEATKT6.js";import{Cb as U,Fb as V,Gb as z,Ib as B,Na as M,Va as r,Wa as v,cb as p,db as T,eb as j,fa as S,fb as O,hb as b,ib as C,ja as h,jb as a,ka as x,kb as l,lb as P,ob as w,rb as _,sb as g,vb as y,wb as m,xb as k,yb as I,zb as E}from"./chunk-MYIS5EFB.js";var se=["messagesScrollBox"];function re(s,d){if(s&1&&(a(0,"p"),m(1),l()),s&2){let n=g();r(1),I("Last seen ",(n.userInfo.last_connection==null?null:n.userInfo.last_connection.hours)+":"+(n.userInfo.last_connection==null?null:n.userInfo.last_connection.minutes),"")}}function ae(s,d){s&1&&(a(0,"p"),m(1," Online "),l())}function ce(s,d){if(s&1){let n=w();a(0,"div",20)(1,"mat-icon",21),_("click",function(){h(n);let i=g().$implicit,t=g(2);return x(t.deleteMessage(i.id))}),m(2,"delete"),l()()}}function le(s,d){if(s&1&&P(0,"img",22),s&2){let n=g(3);p("src",n.userInfo.avatar,M)}}function de(s,d){if(s&1){let n=w();a(0,"div",15),_("mousedown",function(){let t=h(n).$implicit,o=y(2),c=g(2);return x(c.thisUser.id===t.userId?c.selectMessage(o):!1)})("mouseup",function(){let t=h(n).$implicit,o=y(2),c=g(2);return x(c.thisUser.id===t.userId?c.unselectMessage(o):!1)})("click",function(){let t=h(n).$implicit,o=g(2);return x(o.thisUser.id!==t.userId?o.isOpenedMessageOptions=!1:!1)}),a(1,"div",16,17),_("click",function(){let t=h(n).$implicit,o=g(2);return x(o.emoji(o.thisUser.id!==t.userId,t.emoji,t.id))}),b(3,ce,3,0,"div",18)(4,le,1,1,"img",19),m(5),l()()}if(s&2){let n=d.$implicit,e=g(2);O(e.thisUser.id!==n.userId?"message_box_reverce":"message_box"),T("border-top",e.thisUser.id===n.userId&&e.isOpenedMessageOptions?"1px solid rgba(255,255,255,0.4)":"0")("border-bottom",e.thisUser.id===n.userId&&e.isOpenedMessageOptions?"1px solid rgba(255,255,255,0.4)":"0")("padding",e.thisUser.id===n.userId&&e.isOpenedMessageOptions?"3px 0":"0")("background-color",e.thisUser.id===n.userId&&e.isOpenedMessageOptions?"rgba(255,255,255,0.12)":"transparent"),r(1),O(e.thisUser.id!==n.userId&&n.emoji?"message emoji":"message"),j("emoji_reverse",e.thisUser.id===n.userId&&n.emoji),r(2),C(3,e.thisUser.id===n.userId&&e.isOpenedMessageOptions?3:-1),r(1),C(4,e.chatMessaging.usersId.length===2&&e.thisUser.id!==n.userId?4:-1),r(1),I(" ",n.message," ")}}function ge(s,d){if(s&1&&(a(0,"div",23)(1,"div",24),P(2,"img",22)(3,"div",25)(4,"div",25)(5,"div",25),l()()),s&2){let n=g(2);r(2),p("src",n.userInfo.avatar,M)}}function me(s,d){if(s&1&&(a(0,"div")(1,"div",11),P(2,"img",12),a(3,"h4"),m(4),l(),a(5,"p"),m(6),l()(),b(7,de,6,17,"div",13)(8,ge,6,1,"div",14),l()),s&2){let n=g();r(2),p("src",n.userInfo.avatar,M),r(2),k(n.userInfo.name),r(2),k(n.userInfo.bio),r(1),p("ngForOf",n.chatMessaging.messages),r(1),C(8,n.isPrint?8:-1)}}var ye=(()=>{let d=class d{constructor(e,i,t){this.activatedRoute=e,this.reqService=i,this.webSocket=t,this.isPrint=!1,this.isOpenedMessageOptions=!1,this.touchTime=0,this.isChackChatValid=!0,this.token=localStorage.getItem("token"),this.form=new Y({message:new J("",Q.required)}),this.innerWidth=innerWidth,this.setTimeout=setTimeout,this.webSocket.listen("message").subscribe(o=>{if(this.chatMessaging.messages.push(o),setTimeout(()=>{this.messagesBoxScroll&&(this.messagesBoxScroll.nativeElement.scrollTop=this.messagesBoxScroll.nativeElement.scrollHeight)},100),this.thisUser.id!=o.userId){let c=new Audio;c.src="./assets/audios/notifiaction/tones.mp3",c.load(),c.play()}})}scrollDown(){setTimeout(()=>{this.messagesBoxScroll&&(this.messagesBoxScroll.nativeElement.scrollTop=this.messagesBoxScroll.nativeElement.scrollHeight)},100)}ngOnInit(){this.webSocket.listen("printing").subscribe(e=>{this.isPrint=e.printing,this.scrollDown()}),this.webSocket.listen("emoji").subscribe(e=>{this.reqService.post(f.getChat,{clientToken:this.token,chatId:this.chatInfo.id}).subscribe(i=>{this.chatMessaging=i})}),this.activatedRoute.params.subscribe(e=>{this.idParam=e.id;let i=e.id,t={token:this.token,id:i};this.reqService.post(f.getUserById,t).subscribe(c=>{this.userInfo=c});let o={token:this.token};this.reqService.post(f.getUserByToken,o).subscribe(c=>{this.thisUser=c,this.reqService.post(f.checkChat,{id1:i,id2:c.id}).subscribe(u=>{this.chatMessaging=u,this.chatInfo=u,setTimeout(()=>{this.messagesBoxScroll&&(this.messagesBoxScroll.nativeElement.scrollTop=this.messagesBoxScroll.nativeElement.scrollHeight)},100),this.isChackChatValid=u.status!==400})})})}changeSendInput(){this.scrollDown();let e={chatId:this.chatInfo.id,token:this.token,printing:!0};this.webSocket.emit("printing",e),this.inputChangeTimeOut&&clearTimeout(this.inputChangeTimeOut),this.inputChangeTimeOut=setTimeout(()=>{this.scrollDown();let i={chatId:this.chatInfo.id,token:this.token,printing:!1};this.webSocket.emit("printing",i)},2e3)}focusedSendInput(){}blurSendInput(){}send(){if(this.form.value.message){let e=new Audio;if(e.src="assets/audios/send-tone.mp3",e.load(),e.play(),!this.isChackChatValid){let c={usersId:[],messages:[]};this.chatMessaging=c,this.addNewChat().subscribe(u=>{this.chatMessaging=u,this.chatInfo=u,this.isChackChatValid=!0})}let i=new Date,t={message:this.form.value.message,userId:this.thisUser.id?this.thisUser.id:"",date:{day:i.getDay(),month:i.getMonth(),year:i.getFullYear(),hours:i.getHours(),minutes:i.getMinutes(),date:i.getDate()}};this.chatMessaging.messages.push(t);let o={message:this.form.value.message,chatId:this.chatInfo.id,token:this.token};this.webSocket.emit("message",o)}this.form.reset(),setTimeout(()=>{this.messagesBoxScroll?.nativeElement.scrollTo(0,this.messagesBoxScroll?.nativeElement.scrollHeight)},100)}addNewChat(){let e=this.idParam;return this.reqService.post(f.chat,{clientToken:this.token,message:this.form.value.message,userId:e})}deleteMessage(e){confirm("delete this message?")&&this.reqService.delete(f.chatMessagesDelete,{token:this.token,chatId:this.chatMessaging.id,messageId:e}).subscribe(i=>{this.isOpenedMessageOptions=!1,this.chatMessaging.messages=i})}selectMessage(e){e.style.transition=".3s",e.style.scale=".96",this.messageSelectTimeOut=setTimeout(()=>{this.isOpenedMessageOptions=!0},800)}unselectMessage(e){e.style.transition=".3s",e.style.scale="1",clearTimeout(this.messageSelectTimeOut)}emoji(e,i,t){this.touchTime==0?this.touchTime=new Date().getTime():new Date().getTime()-this.touchTime<800?e&&(this.webSocket.emit("emoji",{token:this.token,chatId:this.chatMessaging.id}),i?this.reqService.post(f.removeEmoji,{token:this.token,chatId:this.chatMessaging.id,messageId:t}).subscribe(o=>{this.isOpenedMessageOptions=!1,this.chatMessaging.messages=o}):this.reqService.post(f.setEmoji,{token:this.token,chatId:this.chatMessaging.id,messageId:t}).subscribe(o=>{this.isOpenedMessageOptions=!1,this.chatMessaging.messages=o})):this.touchTime=new Date().getTime()}};d.\u0275fac=function(i){return new(i||d)(v(q),v(R),v(oe))},d.\u0275cmp=S({type:d,selectors:[["app-chat"]],viewQuery:function(i,t){if(i&1&&z(se,5),i&2){let o;V(o=B())&&(t.messagesBoxScroll=o.first)}},standalone:!0,features:[E([]),U],decls:20,vars:8,consts:[[1,"main-div"],[1,"lear"],[1,"selected_chat_user"],["routerLink","/chats-menu"],["appResizeHeight","",1,"messages_scroll_box",3,"size"],["messagesScrollBox",""],[4,"ngIf"],[1,"message_sending_panel"],[3,"formGroup","ngSubmit"],["matInput","","formControlName","message","placeholder","Type your message...","name","message","type","text",1,"message_input",3,"input","blur","focus"],[1,"send_button",3,"disabled","click"],[1,"user_box"],["alt","avatar",3,"src"],[3,"border-top","border-bottom","padding","background-color","class","mousedown","mouseup","click",4,"ngFor","ngForOf"],["class","message_box_reverce"],[3,"mousedown","mouseup","click"],[3,"click"],["myMessage",""],["class","message_options"],["class","in-chat-user-avatar","alt","user img",3,"src"],[1,"message_options"],["color","warn",3,"click"],["alt","user img",1,"in-chat-user-avatar",3,"src"],[1,"message_box_reverce"],[1,"message"],[1,"circle"]],template:function(i,t){i&1&&(a(0,"div",0)(1,"div",1)(2,"div",2)(3,"a",3)(4,"mat-icon"),m(5,"arrow_back_ios"),l()(),a(6,"div")(7,"h2"),m(8),l(),b(9,re,2,1,"p")(10,ae,2,0),l()(),a(11,"div",4,5),b(13,me,9,5,"div",6),l(),a(14,"div",7)(15,"form",8),_("ngSubmit",function(){return t.send()}),a(16,"input",9),_("input",function(){return t.changeSendInput()})("blur",function(){return t.blurSendInput()})("focus",function(){return t.focusedSendInput()}),l(),a(17,"button",10),_("click",function(){return t.send()}),a(18,"mat-icon"),m(19,"arrow_upward"),l()()()()()()),i&2&&(r(8),k(t.userInfo?t.userInfo.name:"..."),r(1),C(9,t.userInfo&&!t.userInfo.isOnline?9:10),r(2),p("size",t.innerWidth>940?130:140),r(2),p("ngIf",t.chatMessaging&&t.userInfo),r(2),p("formGroup",t.form),r(2),p("disabled",t.form.invalid),r(1),O(t.form.valid?"send_button_icon-anim":""))},dependencies:[H,A,$,te,K,G,W,L,X,Z,D,ie,ne,ee,F,N],styles:['.main-div[_ngcontent-%COMP%]{background-color:#262626;height:100vh}.lear[_ngcontent-%COMP%]{height:100%;display:flex;align-items:center;flex-direction:column;padding:58px 20px 0;position:relative;backdrop-filter:blur(2px);-webkit-backdrop-filter:blur(2px);background-color:#0000001f}[_ngcontent-%COMP%]::-webkit-scrollbar{width:0}.message[_ngcontent-%COMP%]{padding:10px 20px;border-radius:20px 20px 0;background:rgb(0,80,239);display:flex;align-items:center;position:relative;margin-left:40px;color:#fff;font-family:Poppins;font-weight:400;line-height:21px;text-align:left}.message_box[_ngcontent-%COMP%]{width:100%;display:flex;align-items:center;justify-content:end;margin-top:20px}.message_box_reverce[_ngcontent-%COMP%]{width:100%;display:flex;align-items:center;justify-content:start;margin-top:20px}.message_box_reverce[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{padding:10px 20px;background-image:none;background-color:#0e0e0e;border:1px solid #ffffff26;border-radius:20px 20px 20px 0;color:#fff}.message_sending_panel[_ngcontent-%COMP%]{position:fixed;bottom:0;background-color:#000;padding:16px 30px;width:100%;border-top-left-radius:32px;border-top-right-radius:32px}.circle[_ngcontent-%COMP%]{margin:4px 0;background-color:#fff;width:10px;height:10px;border-radius:50%;animation:_ngcontent-%COMP%_circle-anim-1 1s alternate infinite linear}@keyframes _ngcontent-%COMP%_circle-anim-1{0%{background-color:#fff;scale:1.1}50%{background-color:#ffffff70}70%{background-color:#ffffff1a}to{background-color:#fff}}.circle[_ngcontent-%COMP%] + .circle[_ngcontent-%COMP%]{margin:0 5px;animation:_ngcontent-%COMP%_circle-anim-2 1s alternate infinite linear}@keyframes _ngcontent-%COMP%_circle-anim-2{0%{background-color:#ffffff70}50%{background-color:#fff;scale:1.1}70%{background-color:#ffffff1a}to{background-color:#ffffff70}}.circle[_ngcontent-%COMP%] + .circle[_ngcontent-%COMP%] + .circle[_ngcontent-%COMP%]{margin:0;animation:_ngcontent-%COMP%_circle-anim-3 1s alternate infinite linear}@keyframes _ngcontent-%COMP%_circle-anim-3{0%{background-color:#ffffff17}50%{background-color:#ffffff78}70%{background-color:#fff;scale:1.1}to{background-color:#ffffff17}}.message_sending_panel[_ngcontent-%COMP%] > form[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center}.message_input[_ngcontent-%COMP%]{background-color:#262626;display:block;border:none;outline:none;width:85%;border-radius:30px;padding:11px 24px;color:#fff;font-family:Poppins;font-size:16px;font-weight:400;line-height:18px;text-align:left;margin-right:20px}.message_input[_ngcontent-%COMP%]::placeholder{color:#7a7a7a}.controllers_box[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:flex-end;padding:0 25px}.send_button[_ngcontent-%COMP%]{width:40px;height:40px;border:none;border-radius:50%;background-color:#fff}.send_button[_ngcontent-%COMP%]:disabled{opacity:.3}.send_button[_ngcontent-%COMP%] > mat-icon[_ngcontent-%COMP%]{color:#7100ff}.send_button_icon-anim[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_send_anim alternate-reverse .4s ease-in-out infinite}@keyframes _ngcontent-%COMP%_send_anim{0%{margin-bottom:10px}to{margin-bottom:-10px;scale:1}}.messages_scroll_box[_ngcontent-%COMP%]{width:100%;overflow-y:scroll;padding-bottom:40px}.selected_chat_user[_ngcontent-%COMP%]{justify-content:center;z-index:500;padding:10px 25px;background-color:#000;position:absolute;left:0;top:0;width:100%;display:flex;align-items:center;border-bottom-left-radius:32px;border-bottom-right-radius:32px}.selected_chat_user[_ngcontent-%COMP%] > a[_ngcontent-%COMP%]{position:absolute;left:25px;margin-right:20px;display:none;width:25px}.selected_chat_user[_ngcontent-%COMP%] > a[_ngcontent-%COMP%] > mat-icon[_ngcontent-%COMP%]{color:#fff;display:block;font-size:25px}.selected_chat_user[_ngcontent-%COMP%] > .img_box[_ngcontent-%COMP%]{width:45px;height:45px;position:relative}.selected_chat_user[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] + div[_ngcontent-%COMP%]{margin-left:20px;display:flex;flex-direction:column}.selected_chat_user[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] > p[_ngcontent-%COMP%]{color:#8d8d8d;font-family:Poppins;font-size:12px;font-weight:500;line-height:18px;text-align:center}.selected_chat_user[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] > h2[_ngcontent-%COMP%]{color:#fff;font-family:Poppins;font-size:25px;font-weight:600;line-height:33px;text-align:center}.in-chat-user-avatar[_ngcontent-%COMP%]{width:30px;height:30px;object-fit:cover;border-radius:50%;display:block;position:absolute;left:-40px}.first_message_block[_ngcontent-%COMP%]{background:linear-gradient(to left,rgba(152,46,131,.18),rgba(0,51,153,.2));backdrop-filter:blur(3px);-webkit-backdrop-filter:blur(3px);width:100%;height:100vh;position:absolute;top:84px;z-index:99;display:flex;align-items:center;justify-content:center;flex-direction:column}.first_message_block[_ngcontent-%COMP%] > h3[_ngcontent-%COMP%]{font-size:35px;color:#fff;margin-bottom:30px}.first_message_block[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] > form[_ngcontent-%COMP%] > input[_ngcontent-%COMP%]{font-size:40px;padding:10px 25px;border:none;border-radius:40px;outline:5px solid #363636;background-color:#3d3d3d;font-family:Asap Condensed,sans-serif;letter-spacing:2px;width:500px;color:#fff}.first_message_block[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{position:relative}.first_message_block[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] > form[_ngcontent-%COMP%] > input[_ngcontent-%COMP%]:focus{outline:5px solid #5c13a4}.first_message_block[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] > button[_ngcontent-%COMP%] > mat-icon[_ngcontent-%COMP%]{font-size:35px;width:33px;height:31px;color:#fff;display:flex;align-items:center;justify-content:center}.first_message_block[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] > button[_ngcontent-%COMP%]{border:none;background-color:#639;padding:15px;border-radius:50%;display:flex;align-items:center;justify-content:center;position:absolute;right:3px;top:3px}@media screen and (max-width: 940px){.lear[_ngcontent-%COMP%]{padding:70px 16px 0}.selected_chat_user[_ngcontent-%COMP%]{padding:16px 25px}.selected_chat_user[_ngcontent-%COMP%] > a[_ngcontent-%COMP%]{display:block}}@media screen and (max-width: 594px){.first_message_block[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] > form[_ngcontent-%COMP%] > input[_ngcontent-%COMP%]{width:100%}.first_message_block[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{width:90%}.messages_scroll_box[_ngcontent-%COMP%]{width:100%}.message_box[_ngcontent-%COMP%]{margin-top:5px}.message[_ngcontent-%COMP%]{scale:.9}}@media screen and (max-width: 574px){.first_message_block[_ngcontent-%COMP%] > h3[_ngcontent-%COMP%]{font-size:30px;text-align:center;max-width:90%}}.user_box[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;flex-direction:column;padding:40px 0}.user_box[_ngcontent-%COMP%] > img[_ngcontent-%COMP%]{width:100px;height:100px;border-radius:50%;object-fit:cover}.user_box[_ngcontent-%COMP%] > h4[_ngcontent-%COMP%]{color:#fff;font-family:Poppins;font-weight:700;margin-top:10px;font-size:25px}.user_box[_ngcontent-%COMP%] > p[_ngcontent-%COMP%]{color:gray;font-family:Poppins;font-weight:700;margin-top:10px}.message_options[_ngcontent-%COMP%]{position:absolute;left:-25px}.emoji[_ngcontent-%COMP%]:after{content:"\\2764\\fe0f";position:absolute;bottom:-10px;right:-10px;background-color:#282828;padding:1px 3px;display:flex;align-items:center;justify-content:center;box-shadow:#00000059 0 5px 15px;border-radius:10px}.emoji_reverse[_ngcontent-%COMP%]:after{content:"\\2764\\fe0f";position:absolute;bottom:-10px;left:-10px;background-color:#282828;padding:1px 3px;display:flex;align-items:center;justify-content:center;box-shadow:#00000059 0 5px 15px;border-radius:10px}']});let s=d;return s})();export{ye as a};
